---
import { getCollection } from 'astro:content';
import GlossaryLayout from '@/layouts/GlossaryLayout.astro';
import RelatedTerms from '@/components/glossary/RelatedTerms.astro';
import BookReference from '@/components/glossary/BookReference.astro';
import { getCategoryColor, getDifficultyBadge, getCategoryLabel } from '@/utils/glossary';

export async function getStaticPaths() {
  const glossaryTerms = await getCollection('glossary');
  return glossaryTerms.map(term => ({
    params: { slug: term.slug },
    props: { term },
  }));
}

const { term } = Astro.props;
const { Content } = await term.render();

const breadcrumbs = [
  { label: 'Home', href: '/' },
  { label: 'Glossary', href: '/glossary' },
  { label: getCategoryLabel(term.data.category), href: `/glossary#${term.data.category}` },
  { label: term.data.term, href: '' },
];
---

<GlossaryLayout frontmatter={term.data}>
  <!-- Breadcrumbs -->
  <nav class="mb-6 text-sm text-gray-600">
    <ol class="flex flex-wrap items-center gap-2">
      {breadcrumbs.map((crumb, index) => (
        <li class="flex items-center gap-2">
          {index > 0 && <span class="text-gray-400">/</span>}
          {crumb.href ? (
            <a href={crumb.href} class="hover:text-blue-600 transition-colors">
              {crumb.label}
            </a>
          ) : (
            <span class="font-medium text-gray-900">{crumb.label}</span>
          )}
        </li>
      ))}
    </ol>
  </nav>

  <!-- Main Content -->
  <article class="glossary-content">
    <!-- Metadata Badges -->
    <div class="mb-6 flex flex-wrap gap-2">
      <span class={`inline-block px-3 py-1 rounded-full text-sm font-medium border ${getCategoryColor(term.data.category)}`}>
        {getCategoryLabel(term.data.category)}
      </span>
      <span class={`inline-block px-3 py-1 rounded-full text-sm font-medium ${getDifficultyBadge(term.data.difficulty)}`}>
        {term.data.difficulty.charAt(0).toUpperCase() + term.data.difficulty.slice(1)}
      </span>
    </div>

    <!-- Book Reference (if exists) -->
    <BookReference bookRef={term.data.bookRef} />

    <!-- Rendered Markdown Content -->
    <div class="prose prose-lg max-w-none">
      <Content />
    </div>

    <!-- Related Terms Section -->
    {term.data.relatedTerms && term.data.relatedTerms.length > 0 && (
      <div class="mt-12 pt-8 border-t border-gray-200">
        <RelatedTerms relatedSlugs={term.data.relatedTerms} />
      </div>
    )}
  </article>
</GlossaryLayout>

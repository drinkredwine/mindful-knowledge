---
interface Props {
  bookId: string;
}

const { bookId } = Astro.props;

// Load books data
let book = null;
try {
  const response = await fetch(new URL('/books.json', Astro.url));
  const booksData = await response.json();
  book = booksData.books[bookId];
} catch (e) {
  console.error('Failed to load book data', e);
}
---

{book && (
  <div class="book-card border border-gray-200 rounded-lg p-6 hover:shadow-lg transition">
    <div class="flex gap-4">
      <img
        src={book.cover}
        alt={`${book.title} by ${book.author}`}
        class="w-32 h-auto rounded shadow-md"
      />
      <div class="flex-1">
        <h3 class="text-xl font-bold mb-2">{book.title}</h3>
        <p class="text-gray-600 mb-2">{book.author} ({book.year})</p>
        <p class="text-sm mb-3">{book.summary}</p>
        {book.keyQuote && (
          <blockquote class="border-l-4 border-blue-500 pl-3 italic text-sm text-gray-700">
            "{book.keyQuote}"
          </blockquote>
        )}
        {book.keyInsight && (
          <blockquote class="border-l-4 border-purple-500 pl-3 italic text-sm text-gray-700 mt-2">
            {book.keyInsight}
          </blockquote>
        )}
        {book.critique && (
          <div class="mt-3 bg-amber-50 border-l-4 border-amber-500 pl-3 py-2 text-sm">
            <strong class="text-amber-900">Critical Note:</strong>
            <p class="text-amber-800">{book.critique}</p>
          </div>
        )}
      </div>
    </div>
  </div>
)}

{!book && (
  <div class="book-card border border-red-200 bg-red-50 rounded-lg p-6">
    <p class="text-red-600">Book not found: {bookId}</p>
  </div>
)}
